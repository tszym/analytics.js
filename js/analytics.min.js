!function(){function a(a){"use strict";var b={version:"0.1.0",csts:{crossfilterClientVsServerThreshold:2e4,resizeDelay:350,css:{header:".navbar",columnsContainer:"#columns",columns:".chart-columns",columnsSortable:".chart-columns-sortable",charts:".chart",chartsClass:"chart",factSelector:"#fact-selector",reset:"#reset",resize:"#resize",addchart:"#addchart",zoom:"zoom"},palettes:["YlGn","GnBu","BuPu","RdPu","PuRd","OrRd","YlOrRd","YlOrBr","PuOr","BrBG","PRGn","PiYG","RdBu","RdGy","RdYlBu","RdYlGn"],scaleType:"quantile",nbBins:6,txts:{charts:{map:"Choropleth map",bar:"Bar chart",pie:"Pie chart",timeline:"Timeline",bubble:"Bubble chart",table:"Table",wordcloud:"Word cloud chart"},factSelector:{cubes:"Cubes available:",measures:"Measures available:"},hiddenChart:"This chart is hidden because the dimension shown is aggregated",changeCube:"You are changing the cube beeing studied. If you continue, your current analysis of this cube will be lost. Do you want to continue?",jenksWarnTitle:"Jenk's natural breaks replaced by quantiles",jenksWarnText:"Jenk's natural breaks can't be used on this dimension because it needs the dimension to have more members than bins on the scale.",hideUnfilteredWarning:"Unfiltered elements of this dimension are hidden from charts."},tips:{charts:{}}}};return b.init=function(a,c){b.query.queryAPI(a),c&&b.state(c),b.query.queryAPI(a),b.display.init(),b.state.initMeasure(),b.state.initDimensions(),b.data.load(),b.display.render()},b.setCsts=function(a){function c(a,b,d){for(var e in b){var f=Array.isArray(a[e])?"array":typeof a[e],g=Array.isArray(b[e])?"array":typeof b[e];"tips"==e&&(d=!0),d&&"undefined"==f&&"undefined"!=g?a[e]=b[e]:"object"==f&&"object"==g?c(a[e],b[e],d):"undefined"!=typeof f&&"object"!=typeof f&&"undefined"!=g&&"object"!=g&&(a[e]=b[e])}}c(b.csts,a,!1)},b.utils=function(){var a={};return a.createMapFromArray=function(a){var b={};return a.forEach(function(a){b[a.id()]=a}),b},a.indexOf=function(a,b){for(var c=0;c<a.length;c++)if(a[c].equals(b))return c;return-1},a.arraysEquals=function(a,b){if(a.length!=b.length)return!1;for(var c in a)if(!a[c].equals(b[c]))return!1;return!0},a.cloneObject=function(a){var b={};for(var c in a)b[c]=a[c];return b},a}(),b.query=function(){function a(a){var b={};for(var c in a)b[c]=a[c].caption;return b}function b(a,b){return c(a,b,"Measure")}function c(a,b,c){if(!e(c))throw new h.IllegalDimensionTypeError;h.getDimensions(a,b);var d=h.cache.getDimensionsFromCache(a,b);for(var f in d)if(d[f].type==c)return f;throw"There's no dimension of type "+c+" in cube "+b+" of schema "+a}function d(a){if("BAD_REQUEST"===a.error)throw new h.QueryAPIBadRequestError;if("NOT_SUPPORTED"===a.error)throw new h.QueryAPINotSupportedError;if("SERVER_ERROR"===a.error)throw new h.QueryAPIServerError;if(void 0===a.error||void 0===a.data||a==={})throw new h.IllegalAPIResponseError;return!0}function e(a){return"Time"===a||"Measure"==a||"Standard"==a||"Geometry"==a}function f(a,b,c){h.cache.isSchemaInCache(a)||h.getSchemas(),h.cache.isCubeInCache(a,b)||h.getCubes(a),h.cache.isDimensionInCache(a,b,c)||h.getDimensions(a,b)}var g=null,h={queryAPI:function(a){if(arguments.length)return g=a,this;if(null===g)throw new this.QueryAPINotProvidedError;return g},getSchemas:function(){if(this.cache.isCacheEmpty()){var b=this.queryAPI().explore([]);d(b);var c=a(b.data);for(var e in c)this.cache.cacheSchema(e,c[e]);return c}return this.cache.getSchemasFromCache()},getCubes:function(b){if(this.cache.isSchemaInCache(b)||this.getSchemas(),0===Object.keys(this.cache.getCubesFromCache(b)).length){var c=this.queryAPI().explore(new Array(b));d(c);var e=a(c.data);for(var f in e)this.cache.cacheCube(b,f,e[f]);return e}return this.cache.getCubesFromCache(b)},getMesures:function(a,c){this.cache.isSchemaInCache(a)||this.getSchemas(),this.cache.isCubeInCache(a,c)||this.getCubes(a),0===Object.keys(this.cache.getDimensionsFromCache(a,c)).length&&this.getDimensions(a,c);var d,e=b(a,c),f=this.getHierarchies(a,c,e);for(var g in f)d=g;if(this.getLevels(a,c,e,d),0===this.cache.getLevelsFromCache(a,c,e,d).length)throw"No level in Measure's hierarchy";return this.getMembers(a,c,e,d,0)},getCubesAndMeasures:function(a){var b={},c=this.getCubes(a);for(var d in c){b[d]={caption:c[d],measures:{}};var e=this.getMesures(a,d);for(var f in e)b[d].measures[f]=e[f]}return b},getDimensions:function(a,b){this.cache.isSchemaInCache(a)||this.getSchemas(),this.cache.isCubeInCache(a,b)||this.getCubes(a);var c,e={};if(0===Object.keys(this.cache.getDimensionsFromCache(a,b)).length){var f=this.queryAPI().explore(new Array(a,b));d(f);for(var g in f.data){var h=f.data[g];this.cache.cacheDimension(a,b,g,h.type,h.caption,h.description)}c=f.data}else c=this.cache.getDimensionsFromCache(a,b);for(var i in c)"Measure"!=c[i].type&&(e[i]=c[i]);return e},getGeoDimension:function(a,b){return c(a,b,"Geometry")},getTimeDimension:function(a,b){return c(a,b,"Time")},getGeoProperty:function(a,b,c,d){for(var e=this.getLevels(a,b,c,d),f=0;f<e.length;f++){var g=this.getProperties(a,b,c,d,f);for(var h in g)if("Geometry"==g[h].type)return h}return null},getHierarchies:function(b,c,e){if(f(b,c,e),0===Object.keys(this.cache.getHierarchiesFromCache(b,c,e)).length){var g=this.queryAPI().explore(new Array(b,c,e));d(g);var h=a(g.data);for(var i in h)this.cache.cacheHierarchy(b,c,e,i,h[i]);return h}return this.cache.getHierarchiesFromCache(b,c,e)},getLevels:function(a,b,c,e){if(f(a,b,c),this.cache.isHierarchyInCache(a,b,c,e)||this.getHierarchies(a,b,c),0===this.cache.getLevelsFromCache(a,b,c,e).length){var g=this.queryAPI().explore(new Array(a,b,c,e),!0);d(g);for(var h=[],i=0;i<g.data.length;i++){this.cache.cacheLevel(a,b,c,e,g.data[i].id,g.data[i].caption,g.data[i].description),h.push(g.data[i].caption);for(var j in g.data[i]["list-properties"])this.cache.cacheProperty(a,b,c,e,i,j,g.data[i]["list-properties"][j].caption,g.data[i]["list-properties"][j].description,g.data[i]["list-properties"][j].type)}return h}return this.cache.getLevelsFromCache(a,b,c,e)},getMembers:function(a,b,c,e,g,h,i,j){if(f(a,b,c),this.cache.isHierarchyInCache(a,b,c,e)||this.getHierarchies(a,b,c),!this.cache.isLevelInCache(a,b,c,e,g)&&(this.getLevels(a,b,c,e),!this.cache.isLevelInCache(a,b,c,e,g)))throw"The level you tried to use does not exists in the database!";h="undefined"!=typeof h?h:!1,"undefined"!=typeof i&&(j="undefined"!=typeof j?j:1);var k,l=this.cache.getLevelIDFromIndex(a,b,c,e,g);if(k="undefined"==typeof i?this.queryAPI().explore(new Array(a,b,c,e,l),h):this.queryAPI().explore(new Array(a,b,c,e,l,i),h,j),d(k),h===!0&&k.data!={}){var m=this.getGeoProperty(a,b,c,e);if(void 0!==m&&null!==m){var n=new Wkt.Wkt;for(var o in k.data)void 0!==k.data[o][m]&&(n.read(k.data[o][m]),k.data[o][m]=n.toJson())}}return k.data},getMembersInfos:function(a,b,c,e,f,g,i){if("object"!=typeof g)throw new Error("You provided an illegal parameter. Array expected");if(!this.isLevelInCache(a,b,c,e,f)&&(this.getLevels(a,b,c,e),!this.isLevelInCache(a,b,c,e,f)))throw new h.LevelNotInDatabaseError;i="undefined"!=typeof i?i:!1;var j=this.getLevelIDFromIndex(a,b,c,e,f),k=this.queryAPI().explore(new Array(a,b,c,e,j,g),i,0);if(d(k),i===!0&&k.data!={}){var l=this.getGeoProperty(a,b,c,e);if(void 0!==l&&null!==l){var m=new Wkt.Wkt;for(var n in k.data)void 0!==k.data[n][l]&&(m.read(k.data[n][l]),k.data[n][l]=m.toJson())}}return k.data},getProperties:function(a,b,c,d,e){return f(a,b,c),this.cache.isHierarchyInCache(a,b,c,d)||this.getHierarchies(a,b,c),this.cache.isLevelInCache(a,b,c,d,e)||this.getLevels(a,b,c,d),this.cache.getPropertiesFromCache(a,b,c,d,e)},drill:function(a){this.queryAPI().drill(a)},push:function(a){this.queryAPI().push(a)},pull:function(a){this.queryAPI().pull(a)},slice:function(a,b,c){this.queryAPI().slice(a,b,c)},dice:function(a){this.queryAPI().dice(a)},project:function(a){this.queryAPI().project(a)},filter:function(a,b,c){this.queryAPI().filter(a,b,c)},execute:function(){var a=this.queryAPI().execute();return d(a),a.data},clear:function(){this.queryAPI().clear()},QueryAPINotProvidedError:function(a){this.name="QueryAPINotProvidedError",this.message=a||"Query have no queryAPI provided!"},QueryAPIServerError:function(a){this.name="QueryAPIServerError",this.message=a||"Query API indicates a Server error!"},QueryAPIBadRequestError:function(a){this.name="QueryAPIBadRequestError",this.message=a||"QueryAPI indicates a Bad Request error!"},QueryAPINotSupportedError:function(a){this.name="QueryAPINotSupportedError",this.message=a||"QueryAPI indicates a call to a not supported function!"},IllegalAPIResponseError:function(a){this.name="IllegalAPIResponseError",this.message=a||"QueryAPI has returned a response with wrong format!"},IllegalDimensionTypeError:function(a){this.name="IllegalDimensionTypeError",this.message=a||"You tried to use an illegal dimension type!"}};return h.QueryAPIServerError.prototype=new Error,h.QueryAPIServerError.prototype.constructor=h.QueryAPIServerError,h.QueryAPINotProvidedError.prototype=new Error,h.QueryAPINotProvidedError.prototype.constructor=h.QueryAPINotProvidedError,h.QueryAPIBadRequestError.prototype=new Error,h.QueryAPIBadRequestError.prototype.constructor=h.QueryAPIBadRequestError,h.QueryAPINotSupportedError.prototype=new Error,h.QueryAPINotSupportedError.prototype.constructor=h.QueryAPINotSupportedError,h.IllegalAPIResponseError.prototype=new Error,h.IllegalAPIResponseError.prototype.constructor=h.IllegalAPIResponseError,h.IllegalDimensionTypeError.prototype=new Error,h.IllegalDimensionTypeError.prototype.constructor=h.IllegalDimensionTypeError,h}(),b.query.cache=function(){function a(a){var b={};for(var c in a)b[c]=a[c].caption;return b}function b(a){return"Time"===a||"Measure"==a||"Standard"==a||"Geometry"==a}function c(a){if(!i.isSchemaInCache(a))throw"The schema you tried to use does not exists in the database!";var b=h.schemas[a];return void 0===b.cubes||0===Object.keys(b.cubes).length}function d(a,b){if(!i.isCubeInCache(a,b))throw"The cube you tried to use does not exists in the database!";var c=h.schemas[a].cubes[b];return void 0===c.dimensions||0===Object.keys(c.dimensions).length}function e(a,b,c){if(!i.isDimensionInCache(a,b,c))throw"The dimension you tried to use does not exists in the database!";var d=h.schemas[a].cubes[b].dimensions[c];return void 0===d.hierarchies||0===Object.keys(d.hierarchies).length}function f(a,b,c,d){if(!i.isHierarchyInCache(a,b,c,d))throw"The hierarchy you tried to use does not exists in the database!";var e=h.schemas[a].cubes[b].dimensions[c].hierarchies[d];return void 0===e.levels||0===e.levels.length}function g(a,b,c,d,e){if(!i.isLevelInCache(a,b,c,d,e))throw"The hierarchy you tried to use does not exists in the database!";var f=h.schemas[a].cubes[b].dimensions[c].hierarchies[d].levels[e].properties;return void 0===f||0===Object.keys(f).length}var h={},i={};return i.clearCache=function(){this.isCacheEmpty()||delete h.schemas},i.isCacheEmpty=function(){return 0===Object.keys(h).length&&void 0===h.schemas},i.isSchemaInCache=function(a){if(this.isCacheEmpty())return!1;for(var b in h.schemas)if(b==a)return!0;return!1},i.isCubeInCache=function(a,b){if(c(a))return!1;for(var d in h.schemas[a].cubes)if(d==b)return!0;return!1},i.isDimensionInCache=function(a,b,c){if(d(a,b))return!1;for(var e in h.schemas[a].cubes[b].dimensions)if(e==c)return!0;return!1},i.isHierarchyInCache=function(a,b,c,d){if(e(a,b,c))return!1;for(var f in h.schemas[a].cubes[b].dimensions[c].hierarchies)if(f==d)return!0;return!1},i.isLevelInCache=function(a,b,c,d,e){var g=h.schemas[a].cubes[b].dimensions[c].hierarchies[d].levels;if(f(a,b,c,d))return!1;if("string"!=typeof e)return void 0!==g[e];for(var i in g)if(g[i].id===e)return!0;return!1},i.isPropertyInCache=function(a,b,c,d,e,f){if(g(a,b,c,d,e))return!1;var i=h.schemas[a].cubes[b].dimensions[c].hierarchies[d].levels[e].properties;for(var j in i)if(j==f)return!0;return!1},i.getSchemasFromCache=function(){return this.isCacheEmpty()?{}:a(h.schemas)},i.getCubesFromCache=function(b){return c(b)?{}:a(h.schemas[b].cubes)},i.getDimensionsFromCache=function(a,b){return d(a,b)?{}:h.schemas[a].cubes[b].dimensions},i.getHierarchiesFromCache=function(b,c,d){return e(b,c,d)?{}:a(h.schemas[b].cubes[c].dimensions[d].hierarchies)},i.getLevelsFromCache=function(a,b,c,d){if(f(a,b,c,d))return[];for(var e=[],g=h.schemas[a].cubes[b].dimensions[c].hierarchies[d].levels,i=0;i<g.length;i++)e[i]=g[i].caption;return e},i.getPropertiesFromCache=function(a,b,c,d,e){return g(a,b,c,d,e)?{}:h.schemas[a].cubes[b].dimensions[c].hierarchies[d].levels[e].properties},i.cacheSchema=function(a,b){this.isSchemaInCache(a)||(this.isCacheEmpty()&&(h.schemas={}),h.schemas[a]={caption:b})},i.cacheCube=function(a,b,c,d){this.isCubeInCache(a,b)||(void 0===h.schemas[a].cubes&&(h.schemas[a].cubes={}),h.schemas[a].cubes[b]={caption:c,description:d})},i.cacheDimension=function(a,c,d,e,f,g){if(!b(e))throw"Cannot cache the dimension "+d+": "+e+" is not a valid dimension type!";if(!this.isDimensionInCache(a,c,d)){void 0===h.schemas[a].cubes[c].dimensions&&(h.schemas[a].cubes[c].dimensions={});var i={type:e,caption:f,description:g};h.schemas[a].cubes[c].dimensions[d]=i}},i.cacheHierarchy=function(a,b,c,d,e,f){if(!this.isHierarchyInCache(a,b,c,d)){var g=h.schemas[a].cubes[b].dimensions[c];void 0===g.hierarchies&&(g.hierarchies={}),g.hierarchies[d]={caption:e,description:f}}},i.cacheLevel=function(a,b,c,d,e,f,g){if(!i.isLevelInCache(a,b,c,d,e)){var j=h.schemas[a].cubes[b].dimensions[c].hierarchies[d];void 0===j.levels&&(j.levels=[]),j.levels.push({id:e,caption:f,description:g})}},i.cacheProperty=function(a,b,c,d,e,f,g,j,k){if(!i.isPropertyInCache(a,b,c,d,e,f)){var l=h.schemas[a].cubes[b].dimensions[c].hierarchies[d].levels[e];void 0===l.properties&&(l.properties={}),l.properties[f]={caption:g,description:j,type:k}}},i.getLevelIDFromIndex=function(a,b,c,d,e){if(!i.isLevelInCache(a,b,c,d,e))throw"The level you tried to use does not exists in the database!";return h.schemas[a].cubes[b].dimensions[c].hierarchies[d].levels[e].id},i}(),b.data=function(){function a(){var a=1,c=b.state.dimensions();for(var d in c)if(!c[d].aggregated()){var e=c[d].getLastSlice();a*=Object.keys(e).length}return a}function c(c){return(c?c:a())<b.csts.crossfilterClientVsServerThreshold}function d(a){var d=b.state.dimensions();for(var e in d){null!==d[e]._crossfilterDimension&&d[e]._crossfilterDimension.dispose(),d[e]._crossfilterDimension=null;for(var f in d[e]._crossfilterGroups)d[e]._crossfilterGroups[f].dispose();d[e]._crossfilterGroups=[]}return i=c()?crossfilter(a):crossfilterServer(a)}function e(){b.query.clear(),b.query.drill(b.state.cube().id());var a=b.state.dimensions();l=[],m={};var c=[];for(var e in a){var f=a[e];if(!f.aggregated()){var g=f.getLastSlice(),h=f.hierarchy();l.push(f),m[f.id()]=f.currentLevel(),c.push(h),b.query.slice(h,Object.keys(g))}}b.query.dice(c),k=b.display.getExtraMeasuresUsed(),k.push(b.state.measure());for(var i in k)b.query.push(k[i].id());var j=b.query.execute();return d(j)}function f(){var a,c={api:b.query,schema:b.state.schema(),cube:b.state.cube().id(),measures:[],dimensions:{}},e=b.state.dimensions();m={},l=e.slice();for(a in e){var f=e[a];m[f.id()]=f.currentLevel(),c.dimensions[f.id()]={hierarchy:f.hierarchy(),level:f.currentLevel(),members:Object.keys(f.getLastSlice())}}k=b.display.getExtraMeasuresUsed(),k.push(b.state.measure());for(a in k)c.measures.push(k[a].id());return d(c)}function g(a,c,d){d=d||b.state.measure(),a.crossfilterDimension().filterAll(),c.crossfilterDimension().filterAll();var e=i.dimension(function(b){return b[a.id()]+"///"+b[c.id()]}),f=e.group().reduceSum(function(a){return a[d.id()]}).all().map(function(a){return a.value});return a.filterAccordingToState(),c.filterAccordingToState(),e.dispose(),f}function h(a,c,d){d=d||b.state.measure(),b.query.clear(),b.query.drill(b.state.cube().id());var e=b.state.dimensions();for(var f in e){var g=e[f];if(!g.aggregated()){var h=Object.keys(g.getLastSlice());g.equals(a)||g.equals(c)||!g.getLastFilters().length||(h=g.getLastFilters()),b.query.slice(g.hierarchy(),h)}}b.query.dice([a.hierarchy(),c.hierarchy()]),b.query.push(d.id());var i=b.query.execute();return i.map(function(a){return a[d.id()]})}var i,j={},k=[],l=[],m={};return j.load=function(){try{return c()?e():f()}catch(a){new PNotify({title:"Error while loading data",type:"error"})}},j.loadIfNeeded=function(){var a,d=k.map(function(a){return a.id()}),e=b.display.getExtraMeasuresUsed();for(a in e)if(d.indexOf(e[a].id())<0)return j.load(),!0;var f=l.map(function(a){return a.id()}),g=b.state.dimensions().filter(function(a){return!a.aggregated()});for(a in g)if(f.indexOf(g[a].id())<0)return j.load(),!0;var h=b.state.dimensions();for(a in h)if(h[a].currentLevel()!=m[h[a].id()])return j.load(),!0;var i=l.reduce(function(a,b){return a*Object.keys(b.getLastSlice()).length},1),n=c(i),o=c();return!n&&o?(j.load(),!0):!1},j.getCrossfilterDimension=function(a,b){return null===a._crossfilterDimension&&(a._crossfilterDimension=i.dimension(function(b){return b[a.id()]}),void 0!==b&&b.length&&a._crossfilterDimension.filterFunction(function(a){for(var c=0;c<b.length;c++)if(b[c]==a)return!0;return!1})),a._crossfilterDimension},j.getCrossfilterGroup=function(a,c){if(Array.isArray(c)&&0!==c.length){var d=[b.state.measure().id()];for(var e in c)d.indexOf(c[e].id())<0&&d.push(c[e].id());var f=d.sort().join(",");return void 0===a._crossfilterGroups[f]&&(a._crossfilterGroups[f]=a.crossfilterDimension().group().reduce(function(a,b){for(var c in d)a[d[c]]+=b[d[c]];return a},function(a,b){for(var c in d)a[d[c]]-=b[d[c]];return a},function(){var a={};for(var b in d)a[d[b]]=0;return a})),a._crossfilterGroups[f]}return void 0===a._crossfilterGroups.default&&(a._crossfilterGroups.default=a.crossfilterDimension().group().reduceSum(function(a){return a[b.state.measure().id()]})),a._crossfilterGroups.default},j.getValues2D=function(a,b,d){return c()?g(a,b,d):h(a,b,d)},j}(),b.data.cube=function(a,b,c){var d=a,e=b,f=c,g={};return g.id=function(a){return arguments.length?(d=a,g):d},g.caption=function(a){return arguments.length?(e=a,g):e},g.description=function(a){return arguments.length?(f=a,g):f},g.equals=function(a){return"function"==typeof a.id&&d===a.id()},g},b.data.measure=function(a,b,c){var d=a,e=b,f=c,g={};return g.id=function(a){return arguments.length?(d=a,g):d},g.caption=function(a){return arguments.length?(e=a,g):e},g.description=function(a){return arguments.length?(f=a,g):f},g.equals=function(a){return"function"==typeof a.id&&d===a.id()},g},b.data.property=function(a,b,c){var d=a,e=b,f=c,g={};return g.id=function(a){return arguments.length?(d=a,g):d},g.caption=function(a){return arguments.length?(e=a,g):e},g.type=function(a){return arguments.length?(f=a,g):f},g.equals=function(a){return"function"==typeof a.id&&d===a.id()},g},b.data.dimension=function(a,c,d,e,f,g,h){var i={},j=a,k=c,l=d,m=f,n=e,o=g,p=h,q=[],r=b.csts.scaleType,s=b.csts.palettes[b.data.dimension.nextI++%b.csts.palettes.length],t=b.csts.nbBins;i._crossfilterDimension=null,i._crossfilterGroups={};var u=!1;i.id=function(){return j},i.caption=function(){return k},i.description=function(){return l},i.hierarchy=function(){return m},i.levels=function(){return o},i.type=function(){return n},i.properties=function(){return p},i.getGeoProperty=function(){for(var a in p)if("Geometry"==p[a].type())return p[a];return null},i.aggregated=function(a){if(!arguments.length)return u;if(u=a)i.crossfilterDimension().filterAll();else{var b=i.filters();b.length>0?i.crossfilterDimension().filterFunction(function(a){for(var c=0;c<b.length;c++)if(b[c]==a)return!0;return!1}):i.crossfilterDimension().filterAll()}return i},i.equals=function(a){return"function"==typeof a.id&&j===a.id()},i.membersStack=function(){return q.map(function(a){return a.members})},i.addSlice=function(a){return q.push({members:a,filters:[]}),i},i.removeLastSlice=function(){return q=q.slice(0,-1),i},i.getLastSlice=function(){return i.getSlice(q.length-1)},i.getSlice=function(a){return q[a].members},i.currentLevel=function(){return u?0:q.length-1},i.maxLevel=function(){return o.length-1},i.isDrillPossible=function(){return i.currentLevel()<i.maxLevel()&&!v},i.isRollPossible=function(){return i.currentLevel()>0},i.nbRollPossible=function(){return i.currentLevel()};var v=!1;i.isPartialDrillDown=function(a){return arguments.length?(v=a,i):v},i.filtersStack=function(){return q.map(function(a){return a.filters})},i.getLastFilters=function(){return i.getFilters(q.length-1)},i.getFilters=function(a){return q[a].filters},i.filters=function(a){return arguments.length?(q[q.length-1].filters=a,i):i.getLastFilters()},i.filter=function(a,b){return b?i.addFilter(a):i.removeFilter(a)},i.addFilter=function(a){var b=i.getLastFilters();return b.indexOf(a)<0&&b.push(a),i},i.removeFilter=function(a){var b=i.getLastFilters();return b.indexOf(a)>=0&&b.splice(b.indexOf(a),1),i},i.colors=function(){return colorbrewer[s][t]},i.scaleType=function(a){return arguments.length?(r=a,i):r},i.colorPalette=function(a){return arguments.length?(s=a,i):s},i.nbBins=function(a){return arguments.length?(t=a,i):t},i.scale=function(){switch("natural"==r&&i.crossfilterGroup().all().length<=t&&(r="quantile",new PNotify({title:b.csts.txts.jenksWarnTitle,text:b.csts.txts.jenksWarnText})),r){case"natural":return d3.scale.threshold().domain(ss.jenks(i.values(),t).splice(1,t-1)).range(i.colors());case"quantize":return d3.scale.quantize().domain(i.domain()).range(i.colors());case"quantile":return d3.scale.quantile().domain(i.values()).range(i.colors())}};var w={};i.values=function(a,c){if(null===x){var d=i.crossfilterGroup(a).all();return y&&i.filters().length&&(d=d.filter(function(a){return i.filters().indexOf(a.key)>=0})),d.map(function(b){return a?b.value[c]:b.value})}return console.log(c),c=c||b.state.measure(),void 0===w[c.id()]&&(w[c.id()]=b.data.getValues2D(i,x,c)),w[c.id()]},i.domain=function(a,b){return d3.extent(i.values(a,b))},i.domainWithPadding=function(a,b,c){var d=i.domain(b,c),e=d[1]-d[0];return d[0]=d[0]-a*e,d[1]=d[1]+a*e,d};var x=null;i.freezeDomainAccross=function(a){return x=a,i},i.unfreezeDomain=function(){return x=null,w={},i};var y=!1;return i.hideUnfiltered=function(a){return arguments.length?(y=a,i):y},i.crossfilterDimension=function(){return b.data.getCrossfilterDimension(i,i.getLastFilters())},i.crossfilterGroup=function(a){return b.data.getCrossfilterGroup(i,a)},i.filterAccordingToState=function(){var a=i.getLastFilters();return void 0!==a&&a.length&&i.crossfilterDimension().filterFunction(function(b){for(var c=0;c<a.length;c++)if(a[c]==b)return!0;return!1}),i},i.getTotal=function(){function a(a){return 0===i.filters().length||i.filters().indexOf(a)>=0}return i.crossfilterGroup().all().filter(function(b){return a(b.key)}).map(function(a){return a.value}).reduce(function(a,b){return a+b},0)},i},b.data.dimension.nextI=0,b.state=function(){function c(c,d){f.cube().equals(c)?(f.measure(d),b.data.load(),b.display.redraw()):(f.cube(c),f.measure(d),l=[],b.data.dimension.nextI=0,b.display.resetChartsOptions(),a.filterAll(),f.initDimensions(),b.data.load(),b.display.render())}function d(){var a={schema:b.state.schema(),cube:b.state.cube().id(),measure:b.state.measure().id(),columnWidths:b.display.columnWidths()};return a.dimensions=b.state.dimensions().map(function(a){return{id:a.id(),hierarchy:a.hierarchy(),filters:a.filters(),properties:a.properties().map(function(a){return a.id()}),membersStack:a.membersStack().map(function(a){return Object.keys(a)}),scaleType:a.scaleType(),colorPalette:a.colorPalette(),nbBins:a.nbBins()}}),a.charts=b.display.chartsInLayout().map(function(a,b){return b>0?a.map(function(a){return{type:a.type(),options:a.options(),dimensions:a.dimensions().map(function(a){return a.id()}),extraMeasures:a.extraMeasures().map(function(a){return a.id()})}}):[]}),a}function e(a){try{f.schema(a.schema);var c=b.query.getCubes(a.schema);f.cube(b.data.cube(a.cube,c[a.cube]));var d={},e=b.query.getMesures(a.schema,a.cube);for(var g in e)d[g]=b.data.measure(g,e[g].caption);f.measure(d[a.measure]),b.display.columnWidths(a.columnWidths);var h={},i=b.query.getDimensions(a.schema,a.cube);a.dimensions.forEach(function(c){var d=b.query.getLevels(a.schema,a.cube,c.id,c.hierarchy),e=b.query.getProperties(a.schema,a.cube,c.id,c.hierarchy,0),f=c.properties.map(function(a){return b.data.property(a,e[a].caption,e[a].type)}),g=b.data.dimension(c.id,i[c.id].caption,i[c.id].description,i[c.id].type,c.hierarchy,d,f);c.membersStack.forEach(function(d,e){g.addSlice(b.query.getMembersInfos(a.schema,a.cube,c.id,c.hierarchy,e,d,c.properties.length>0))}),g.filters(c.filters),g.scaleType(c.scaleType),g.colorPalette(c.colorPalette),g.nbBins(c.nbBins),l.push(g),h[g.id()]=g}),b.display.createCharts(a.charts,h,d)}catch(j){new PNotify({title:"Data for this analysis is unavailable",type:"error"})}}var f=function(a){return arguments.length?void e(a):d()},g=null,h=null,i=null,j=null,k=null,l=[];return f.schema=function(a){return arguments.length?void(g=a):g},f.cube=function(a){return arguments.length?(j=a,void(h=a.id())):j},f.measure=function(a){return arguments.length?(k=a,void(i=a.id())):k},f.dimensions=function(){return l},f.initMeasure=function(){var a=b.query.getSchemas();(null===g||void 0===a[g])&&(g=Object.keys(a)[0]);var d=b.query.getCubesAndMeasures(g);if(null===h||void 0===d[h]){var e=Object.keys(d)[0];f.cube(b.data.cube(e,d[e].caption,d[e].description))}if(null===i||void 0===d[h].measures[i]){var j=Object.keys(d[h].measures)[0];f.measure(b.data.measure(j,d[h].measures[j].caption,d[h].measures[j].description))}b.display.showFactSelector(d,f.cube(),f.measure(),c)},f.initDimensions=function(){if(!l.length){var a,c,d=b.query.getGeoDimension(g,h),e=(b.query.getTimeDimension(g,h),b.query.getDimensions(g,h));for(var f in e){var i=Object.keys(b.query.getHierarchies(g,h,f))[0],j=[];if(f==d){var k=b.query.getProperties(g,h,f,i,0),m=b.query.getGeoProperty(g,h,f,i);j.push(b.data.property(m,k[m].caption,k[m].type))}var n=b.query.getLevels(g,h,f,i),o=b.query.getMembers(g,h,f,i,0,j.length>0),p=b.data.dimension(f,e[f].caption,e[f].description,e[f].type,i,n,j);p.addSlice(o),l.push(p),"Geometry"==p.type()?a=p:"Time"==p.type()&&(c=p)}b.display.assignDimensions(l,a,c)}b.display.createWordClouds(l)},f.drillDown=function(a,c,d){if(a.isDrillPossible()){var e;switch(d){case"selected":var f=a.filters().length?a.filters():Object.keys(a.getLastSlice());e={},f.forEach(function(c){var d=b.query.getMembers(g,h,a.id(),a.hierarchy(),a.currentLevel(),a.properties().length>0,c);for(var f in d)e[f]=d[f]});break;case"partial":a.isPartialDrillDown(!0),e={};var i=a.getLastSlice();for(var j in i)j!=c&&(e[j]=i[j]);i=b.query.getMembers(g,h,a.id(),a.hierarchy(),a.currentLevel(),a.properties().length>0,c);for(j in i)e[j]=i[j];break;default:e=b.query.getMembers(g,h,a.id(),a.hierarchy(),a.currentLevel(),a.properties().length>0,c)}a.addSlice(e),b.data.load()}},f.rollUp=function(a,c){if(c=c||1,c=Math.min(c,a.nbRollPossible()),c>0){a.isPartialDrillDown(!1);for(var d=0;c>d;d++)a.removeLastSlice();b.data.load()}},f.freezeDomainsAcross=function(a){l.forEach(function(b){b.equals(a)||b.freezeDomainAccross(a)})},f.unfreezeDomains=function(){l.forEach(function(a){a.unfreezeDomain()})},f}(),b.display=function(){function c(a){return $($(b.csts.css.columns)[a])}function d(a){for(var b=0;b<x.length;b++)for(var c=0;c<x[b].length;c++)if(a.selector()==x[b][c].selector())return{i:b,j:c};return null}function e(a,d,e){d=Math.max(0,Math.min(x.length-1,d)),e=Math.max(0,Math.min(x[d].length,e)),e==x[d].length?x[d][e]=a:x[d].splice(e,0,a);var f=c(d).children("div"),g='<div id="'+a.selectorName()+'" class="'+b.csts.css.chartsClass+'"></div>';0===f.length&&c(d).html(g),f.length<=e?$(f[f.length-1]).after(g):$(f[e]).before(g)}function f(){var a=b.charts.wordcloud("#chart-"+w++);e(a,1,0),v._displayParamsForm(a,!0)}function g(a){var b=d(a),c=a.selector();return $(c).remove(),a.delete(),x[b.i].splice(b.j,1),b}function h(a,c){var d=a.options(),f=(a.selector(),g(a));a=b.charts[c]("#chart-"+w++);for(var h in d)a.setOption(h,d[h]);return e(a,f.i,f.j),a}function i(a){x[a].forEach(function(a){var b=a.selector();a.delete(),$(b).remove()}),x[a]=[]}function j(){0===v.charts().length&&(e(b.charts.map("#chart-"+w++),1,0),e(b.charts.timeline("#chart-"+w++),1,1),e(b.charts.table("#chart-"+w++),1,2),e(b.charts.pie("#chart-"+w++),2,0),e(b.charts.bar("#chart-"+w++),2,1))}function k(){var a={};v.charts().forEach(function(b){a[b.selectorName()]=b}),x=[[],[],[]];for(var b=0;3>b;b++){c(b).children("div").each(function(c){x[b][c]=a[$(this).attr("id")]})}}function l(a,c){function d(d,e,h,i){return i&&!b.charts[c.type].params[i]||!i&&null===b.charts[c.type].options[d]||a.options()[d]==c[d]?!1:(h&&(c[d]=h(c[d])),a.setOption(d,c[d]),"render"==e?f=!0:"redraw"==e&&(g=!0),!0)}var e=!1,f=!1,g=!1,i=!1,j=b.charts[c.type].params.nbDimensionsMax,k=b.charts[c.type].params.nbExtraMeasuresMax;if(c.dimensions=c.dimensions.slice(0,j).filter(function(a){return"undefined"!=typeof a.id}),c.measures=c.measures.slice(0,k).filter(function(a){return"undefined"!=typeof a.id}),c.dimensions.filter(function(a){return a.aggregated()}).length)return void new PNotify("You cannot use aggregated dimensions");if(!b.charts[c.type].arePossibleDimensions(c.dimensions))return void new PNotify("Invalid dimensions selected");if(!b.charts[c.type].arePossibleExtraMeasures(c.measures))return void new PNotify("Invalid axes selected");if(null!==b.charts[c.type].options.topKMeasure&&b.utils.indexOf(c.measures,c.topKMeasure)<0)return void new PNotify("Invalid measure for top k (it is not used on the chart)");if(a.type()!=c.type&&(a=h(a,c.type),f=!0),b.utils.arraysEquals(c.dimensions,a.dimensions())||(a.dimensions(c.dimensions),g=!0,e=!0),b.utils.arraysEquals(c.measures,a.extraMeasures())||(a.extraMeasures(c.measures),g=!0,i=!0),d("sort","redraw"),d("labels","render"),d("playerTimeout","",function(a){return a=parseInt(a),isNaN(a)||50>a?50:a},"displayPlay"),d("topK","redraw",function(a){return a=parseInt(a),isNaN(a)||0>=a?1/0:a}),d("topKMeasure","redraw"),i){var l=b.data.loadIfNeeded();a.render(),l&&b.display.redraw()}else f?a.render():g&&a.redraw();e&&(a.element().filterAll(),n(a),a.redraw())}function m(a,b){a.colorPalette(b.palette),a.nbBins(b.number),a.scaleType(b.scale),a.hideUnfiltered(b.hideUnfiltered);var c;b.hideUnfiltered&&!a.filters().length&&(a.filters(Object.keys(a.getLastSlice())),c=!0),v.getChartsUsingDimension(a).forEach(function(a){c&&n(a),a.setOption("hideUnfiltered",b.hideUnfiltered)}),v.redraw()}function n(a){a.dimensions()[0].filters().forEach(function(b){a.element().hasFilter(b)||a.element().filter(b)})}function o(){b.state.dimensions().forEach(function(a){var b=a.filters(),c=v.getChartsUsingDimension(a);if(b.length&&c.length){var d=c[0];b.forEach(function(a){d.element().hasFilter(a)||d.element().filter(a)})}})}function p(){$(b.csts.css.reset).click(function(){v.filterAll(),v.redraw()});var a=$("body").css("padding-top"),c=$(b.csts.css.header).height(),d=$(b.csts.css.columns).cssUnit("top");$(b.csts.css.resize).click(function(){$(b.csts.css.header).toggle(),$(b.csts.css.header).is(":hidden")?($(b.csts.css.columns).css("top",d[0]-c+d[1]),$("body").css("padding-top","0")):($(b.csts.css.columns).css("top",d.join("")),$("body").css("padding-top",a)),r()}),$(b.csts.css.addchart).click(function(){f()})}function q(){$(b.csts.css.columnsContainer).resizableColumns(),t=$(b.csts.css.columnsContainer).data("resizableColumns"),"undefined"!=typeof u&&t.restoreColumnWidths(u);var a=window.setTimeout(function(){},0);$(window).on("resize",function(){window.clearTimeout(a),a=window.setTimeout(function(){$(window).trigger("resizeend")},350)}),$(window).on("resizeend",r),$(window).on("column:resize:stop",r),$(b.csts.css.columnsSortable).sortable({distance:20,connectWith:b.csts.css.columnsSortable,handle:".chart-header",opacity:.6,cursor:"move",scroll:!1,update:function(){k(),v.resize()}}),d3.select("body").on("mousewheel",function(){d3.event.ctrlKey&&d3.event.preventDefault()
}).on("DOMMouseScroll",function(){d3.event.ctrlKey&&d3.event.preventDefault()}).on("wheel",function(){d3.event.ctrlKey&&d3.event.preventDefault()})}function r(){v.charts().forEach(function(a){a.resize()})}function s(){var a=v.charts();for(var b in a)a[b].build();o(),$(".tooltip").remove()}var t,u,v={},w=0,x=[[],[],[]];return v.columnWidths=function(a){return arguments.length?(u=a,v):t.saveColumnWidths()},v.getTip=function(a,c){return b.csts.tips[a]&&b.csts.tips[a][c]?b.csts.tips[a][c]:""},v.charts=function(){return Array.prototype.concat.apply([],x)},v.chartsInLayout=function(){return x},v.getChartsUsingDimension=function(a){var b=v.charts(),c=[];for(var d in b)b[d].useDimension(a)&&c.push(b[d]);return c},v.getExtraMeasuresUsed=function(){var a={};v.charts().forEach(function(b){b.extraMeasures().forEach(function(b){a[b.id()]=b})});var b=[];for(var c in a)b.push(a[c]);return b},v.createCharts=function(a,c,d){a.forEach(function(a,f){a.forEach(function(a,g){var h=b.charts[a.type]("#chart-"+w++).dimensions(a.dimensions.map(function(a){return c[a]})).extraMeasures(a.extraMeasures.map(function(a){return d[a]}));for(var i in a.options)h.setOption(i,a.options[i]);e(h,f,g)})})},v.createWordClouds=function(a){i(0);for(var c in a){var d=a[c];e(b.charts.wordcloudWithLegend("#chart-"+w++,[d]),0,1/0)}},v.assignDimensions=function(a,b,c){var d,e=v.charts();for(d in e){var f=e[d];f.dimensions("timeline"==f.type()?[c]:[b])}},v._displayParamsForm=function(a,c){function d(a,c){function d(a,b){b?a.slideDown(c):a.slideUp(c)}var e=b.charts[a].params.nbDimensionsMax,f=b.charts[a].params.nbExtraMeasuresMax;w.slice(0,e).slideDown(c),x.slice(0,f).slideDown(c),w.slice(e).slideUp(c),x.slice(f).slideUp(c),d(C,b.charts[a].params.displayPlay),d(z,null!==b.charts[a].options.sort),d(y,null!==b.charts[a].options.labels),d(A,null!==b.charts[a].options.topK),d(B,null!==b.charts[a].options.topKMeasure),p.children("option").removeAttr("disabled");for(F in k)(!b.charts[a].isPossibleDimension(k[F])||k[F].aggregated())&&p.children('option[value="'+k[F].id()+'"]').attr("disabled","disabled");q.children("option").removeAttr("disabled");for(G in m)b.charts[a].isPossibleExtraMeasure(m[G])||q.children('option[value="'+m[G].id()+'"]').attr("disabled","disabled")}var e=a.options(),f=b.state.schema(),h=b.state.cube().id(),i=b.state.dimensions(),j=b.query.getMesures(f,h),k=(b.query.getGeoDimension(f,h),b.utils.createMapFromArray(i)),m={};for(var n in j)m[n]=b.data.measure(n,j[n].caption);var o=$("#chartparam-type"),p=$(".chartparam-dimension"),q=$(".chartparam-measure"),r=$("#chartparam-labels"),s=$("#chartparam-sort"),t=$("#chartparam-topK"),u=$("#chartparam-topKMeasure"),v=$("#chartparam-playerTimeout"),w=p.parent().parent().hide(),x=q.parent().parent().hide(),y=r.parent().parent().hide(),z=s.parent().parent().hide(),A=t.parent().parent().hide(),B=u.parent().parent().hide(),C=v.parent().parent().hide();if(!o.children("option").length)for(var D in b.charts)if("chart"!=D&&"undefined"!=typeof b.charts[D].params&&b.charts[D].params.displayParams===!0){var E=b.csts.txts.charts[D]?b.csts.txts.charts[D]:D;o.append('<option value="'+D+'">'+E+"</option>")}p.empty(),q.empty().append('<option value=""></option>');var F,G;i.forEach(function(a){p.append('<option value="'+a.id()+'">'+a.caption()+"</option>")});for(G in j)q.append('<option value="'+G+'">'+j[G].caption+"</option>");o.val(a.type()),s.val(e.sort),v.val(e.playerTimeout),r.prop("checked",e.labels===!1?"":"checked"),t.val(1/0===e.topK?"0":e.topK),p.each(function(b,c){var d=a.dimensions()[b];d&&$(c).val(d.id())}),q.each(function(b,c){var d=a.extraMeasures()[b];d&&$(c).val(d.id())}),u.val(e.topKMeasure?e.topKMeasure.id():""),d(o.val(),0),o.change(function(){d($(this).val(),400)}),$("#chartparams-set").unbind("click").click(function(){$("#chartparams").modal("hide");var b={dimensions:[],measures:[],sort:s.val(),type:o.val(),topK:t.val(),topKMeasure:m[u.val()],labels:r.prop("checked"),playerTimeout:v.val()};p.each(function(a,c){var d=k[$(c).val()];d&&(b.dimensions[a]=d)}),q.each(function(a,c){var d=m[$(c).val()];d&&(b.measures[a]=d)}),l(a,b)}),$("#chartparams-cancel, #chartparams-delete").unbind("click").click(function(){$("#chartparams").modal("hide")}),c?($("#chartparams-cancel").click(function(){g(a)}),$("#chartparams-delete").hide()):$("#chartparams-delete").show().click(function(){g(a)}),$("#chartparams").modal("show")},v.aggregateDimension=function(a,c){a.aggregated(c),v.getChartsUsingDimension(a).forEach(function(a){a.disabled(c)}),b.data.loadIfNeeded(),v.redraw()},v._displayDimensionParamsForm=function(a){function c(a){var b=colorbrewer[a][Object.keys(colorbrewer[a]).pop()],c=b.map(function(a){return'<span style="background: '+a+'"></span>'}).reduce(function(a,b){return a+b});return'<a class="color-palette" title="'+a+'">'+c+"</a>"}function d(a){$("#dimparam-color-button").html(c(a)+' <span class="caret"></span>'),$("#dimparam-color").val(a);var b=Object.keys(colorbrewer[a]).shift(),d=Object.keys(colorbrewer[a]).pop();$("#dimparam-colors-nb").attr("min",b),$("#dimparam-colors-nb").attr("max",d);var e=Math.min(Math.max(b,$("#dimparam-colors-nb").val()),d);$("#dimparam-colors-nb").val(e)}0===$("#dimparam-color-dropdown li").length&&(b.csts.palettes.forEach(function(a){$("#dimparam-color-dropdown").append("<li>"+c(a)+"</li>")}),$("#dimparam-color-dropdown li a").click(function(){d($(this).attr("title"))})),d(a.colorPalette()),$("#dimparam-colors-nb").val(a.nbBins()),$("#dimparam-scale").val(a.scaleType()),$("#dimparam-hideUnfiltered").prop("checked",a.hideUnfiltered()?"checked":""),$("#dimparams-set").unbind("click").click(function(){$("#dimparams").modal("hide");var b=$("#dimparam-color").val(),c=Object.keys(colorbrewer[b]).shift(),d=Object.keys(colorbrewer[b]).pop(),e=Math.min(Math.max(c,$("#dimparam-colors-nb").val()),d),f={palette:b,number:e,hideUnfiltered:$("#dimparam-hideUnfiltered").prop("checked"),scale:$("#dimparam-scale").val()};m(a,f)}),$("#dimparams").modal("show")},v.freezeScalesAcross=function(a){b.state.freezeDomainsAcross(a),v.charts().forEach(function(a){a.elasticAxes(!1)}),v.render()},v.unfreezeScales=function(){b.state.unfreezeDomains(),v.charts().forEach(function(a){a.elasticAxes(!0)}),v.render()},v.resetChartsOptions=function(){v.charts().forEach(function(a){a.resetOptions()})},v.filterAll=function(){b.state.dimensions().forEach(function(a){a.filters([])}),a.filterAll()},v.filterAllChartsUsingDimension=function(a){a.filters([]);var b=v.getChartsUsingDimension(a);for(var c in b)b[c].element().filterAll()},v._updateFilter=function(a,b,c){a.filter(b,c);var d=v.getChartsUsingDimension(a);for(var e in d)d[e].element().hasFilter(b)!=c&&d[e].element().filter(b);v.charts().forEach(function(a){a.updateTitle()}),v.charts().forEach(function(a){a.updateColors()})},v.init=function(){j(),p(),q()},v.showFactSelector=function(a,c,d,e){b.display.factSelector.init(b.csts.css.factSelector,b.csts.txts.factSelector.cubes,b.csts.txts.factSelector.measures),b.display.factSelector.setMetadata(a),b.display.factSelector.setCallback(e),b.display.factSelector.setSelectedCube(c.id()),b.display.factSelector.setSelectedMeasure(d.id())},v.render=function(){s(),a.renderAll()},v.redraw=function(){s(),a.redrawAll()},v.drillDown=function(a,c,d,e){if(a.isDrillPossible()){var f,g;e.ctrl?(f=a.filters().length?a.filters():Object.keys(a.getLastSlice()),g="selected"):e.shift?(f=Object.keys(a.getLastSlice()),g="partial",new PNotify("After a partial drill-down, you can only roll-up")):(f=[c],g="simple"),v.getChartsUsingDimension(a).forEach(function(a){void 0!==a.element()._onZoomIn&&a.element().chartID()!==d&&a.element()._onZoomIn(f)}),b.state.drillDown(a,c,g),v.filterAllChartsUsingDimension(a),v.redraw()}},v.rollUp=function(a,c,d){if(d=d||1,d=Math.min(d,a.nbRollPossible()),d>0){for(var e=0;d>e;e++)v.getChartsUsingDimension(a).forEach(function(a){void 0!==a.element()._onZoomOut&&a.element().chartID()!==c&&a.element()._onZoomOut()});v.filterAllChartsUsingDimension(a),b.state.rollUp(a,d),v.redraw()}},v}(),b.display.factSelector=function(){var a={container:null,cube:null,displayedCube:null,measure:null,cubes:[],measures:[],data:null,callback:null,init:function(a,b,c){this.cubes.intro=b,this.measures.intro=c,this.container=$(a),this.cubes.container=$("<div></div>"),this.measures.container=$("<div></div>"),this.container.append(this.cubes.container),this.container.append(this.measures.container)},setMetadata:function(a){this.data=a,this.showCubes(),this.resetMeasures()},showCubes:function(a){var b=this;this.cubes.data=this.data,a?this.displayDropdown(this.cubes,function(a){b.selectCube(a)}):this.displayButtons(this.cubes,function(a){b.selectCube(a)})},showMeasures:function(a){var b=this;this.measures.data=this.data[a].measures,this.displayButtons(this.measures,function(a){b.selectMeasure(a)}),this.measures.container.width()+this.cubes.container.width()>this.container.width()?"dropdown"!=this.cubes.type?(this.showCubes(!0),this.setSelectedCube(this.cube),this.measures.container.width()+this.cubes.container.width()>this.container.width()&&this.displayDropdown(this.measures,function(a){b.selectMeasure(a)})):this.displayDropdown(this.measures,function(a){b.selectMeasure(a)}):"dropdown"===this.cubes.type&&(this.showCubes(!1),this.measures.container.width()+this.cubes.container.width()>this.container.width()&&this.showCubes(!0),this.setSelectedCube(this.cube))},displayButtons:function(a,b){this.displayList(a,b,"btn btn-group","btn btn-default"),a.container.empty(),a.container.append(a.intro+" "),a.container.append(a.list),a.type="buttons"},displayDropdown:function(a,b){this.displayList(a,b,"dropdown-menu","",!0),a.container.empty(),a.container.append(a.intro+" "),a.title=$('<a class="btn btn-default dropdown-toggle" data-toggle="dropdown" href="#">'+a.intro+' <span class="caret"></span></a>'),a.container.append($('<div class="btn-group btn-default"></div>').append(a.title).append(a.list)),a.type="dropdown"},displayList:function(a,b,c,d,e){c=c?'class="'+c+'"':"",d=d?'class="'+d+'"':"",a.list=$("<ul "+c+"></ul>");var f=function(a){return b($(this).attr("data-id")),a.preventDefault(),!0};for(var g in a.data){var h=a.data[g].description,i=a.data[g].caption;if(e){var j;j="undefined"!=typeof h&&h!=i?$("<a"+d+' href="#" data-id="'+g+'" data-toggle="tooltip" class="chart-infos" data-placement="bottom" title="'+h+'">'+i+"</a>").tooltip({container:"body",html:!0}):$("<a"+d+' href="#" data-id="'+g+'">'+i+"</a>"),j.click(f),a.list.append($("<li></li>").append(j))}else{var k;k="undefined"!=typeof h&&h!=i?$("<li "+d+' data-id="'+g+'" data-toggle="tooltip" class="chart-infos" data-placement="bottom" title="'+h+'">'+i+"</li>").tooltip({container:"body",html:!0}):$("<li "+d+' data-id="'+g+'">'+i+"</li>"),k.click(f),a.list.append(k)}}},resetMeasures:function(){this.measures.container.empty()},setSelectedCube:function(a){this.cube=a,this.setSelectedElement(this.cubes,a),this.showMeasures(a),this.cube===this.displayedCube&&this.setSelectedMeasure(this.measure)},setSelectedMeasure:function(a){this.setSelectedElement(this.measures,a),this.displayedCube=this.cube,this.measure=a},setSelectedElement:function(a,b){a.list.children("li").each(function(a,c){$(c).attr("data-id")==b?$(c).addClass("active"):$(c).removeClass("active")}),"dropdown"==a.type&&a.title.html(a.data[b].caption+' <span class="caret"></span></a>')},selectCube:function(a){this.setSelectedCube(a)},selectMeasure:function(a){function c(){d.setSelectedMeasure(a),d.callback(b.data.cube(d.cube,d.data[d.cube].caption),b.data.measure(a,d.data[d.cube].measures[a].caption,d.data[d.cube].measures[a].description))}var d=this;this.displayedCube!=this.cube?bootbox.confirm(b.csts.txts.changeCube,function(a){a&&c()}):c()},setCallback:function(a){this.callback=a}};return a}(),b.charts={},b.charts.player=function(b){var c=b.dimensions()[0],d=b.element().hasFilter()?b.element().filters():Object.keys(c.getLastSlice());d.sort();var e=0,f=!0,g=function(){},h=b,i={},j=function(){return e>d.length-1?(g(),h.element().filterAll(),d.forEach(function(a){h.element().filter(a)}),void a.redrawAll()):void(f&&(h.element().filter(d[e]),e-1>=0&&h.element().filter(d[e-1]),a.redrawAll(),e++,setTimeout(j,h.options().playerTimeout)))};return i.running=function(){return f},i.callback=function(a){return arguments.length?(g=a,i):g},i.start=function(){return f=!0,setTimeout(j,h.options().playerTimeout),i},i.pause=function(){return f=!1,i},i},b.charts.chart=function(){function c(c,d){function e(a){return arguments.length?void w.setOption("height",g(a,w.options().heightReference)):f(w.options().height,w.options().heightReference)}function f(a,b){return a*h(b)}function g(a,b){return a/h(b)}function h(a){switch(a){case"columnWidthRatio":return $(z).parent().width();case"columnHeightRatio":return $(z).parent().height();default:return 1}}function i(){$(z).addClass("chart-"+w.type()),$(z).html('<div class="chart-header"></div><div class="chart-text">'+b.csts.txts.hiddenChart+'</div><div class="chart-container"></div>')}function j(){$(z).resizable({handles:"s"}).on("resize",function(a){a.stopPropagation()}).on("resizestop",function(a){a.stopPropagation(),w.resize()})}function k(){o(),p(),q(),u()}function l(){w.element().width(w.width()).height(e()).on("filtered",function(a,c){b.display._updateFilter(w.dimensions()[0],c,a.hasFilter(c))}),"function"==typeof w.element().callbackZoomIn&&w.element().callbackZoomIn(function(a,c,d){b.display.drillDown(w.dimensions()[0],a,c,d)}).callbackZoomOut(function(a,c){b.display.rollUp(w.dimensions()[0],a,c)}),"function"==typeof w.element().colors&&w.element().colorCalculator(function(a){return isNaN(a.value)?"#ccc":w.element().colors()(a.value)})}function m(){r(),s(),t()}function n(){var a=x[0],c=a.getLastSlice(),d=d3.format(".3s");switch(w.element().dimension(a.crossfilterDimension()).group(a.crossfilterGroup(y)).label(function(a){var b=a.key?a.key:a.data.key;return c[b]?c[b].caption:""}).title(function(e){var f=e.key?e.key:e.data.key,g=b.state.measure().caption()+": "+(e.value?d(e.value):0),h=a.caption()+": "+(c[f]?c[f].caption:"");return h+"\n"+g}),w.updateColors(),w.options().sort){case"valueasc":w.element().ordering(function(a){return void 0!==a.value?a.value:a.data.value});break;case"valuedesc":w.element().ordering(function(a){return void 0!==a.value?-a.value:-a.data.value});break;default:w.element().ordering(function(a){return void 0!==a.key?a.key:a.data.key})}null!==w.options().labels&&w.element().renderLabel(w.options().labels),null!==w.options().hideUnfiltered&&w.element().dataHideUnfiltered(w.options().hideUnfiltered)}function o(){$(z+" .chart-header").html('<div class="chart-meta"><span class="chart-infos"></span><span class="chart-levels-icons"></span><span class="chart-levels"></span><span class="btn-params"></span><span class="chart-play"></span></div><div class="chart-title"></div>')}function p(){if(w.params().displayTip){var a=b.display.getTip("charts",w.type());if(a){var c=$('<span data-toggle="tooltip" class="chart-infos" data-placement="bottom" title="'+a+'"><i class="fa fa-nomargin fa-info-circle"></i></span>');$(z+" .chart-meta .chart-infos").replaceWith(c),c.tooltip({container:"body",html:!0})}}}function q(){if(w.params().displayPlay){var a=$('<span class="btn btn-xs btn-default"><i class="fa fa-nomargin fa-play"></i></span>');$(z+" .chart-meta .chart-play").replaceWith(a),a.click(function(){a.children().toggleClass("fa-play"),a.children().toggleClass("fa-pause"),void 0===v?(b.display.freezeScalesAcross(x[0]),v=b.charts.player(w),v.callback(function(){a.children().toggleClass("fa-play"),a.children().toggleClass("fa-pause"),b.display.unfreezeScales(),v=void 0}),w.element().filterAll(),v.start()):v.running()?v.pause():v.start()})}}function r(){if(w.params().displayCanDrillRoll){var a=$(z+" .chart-meta .chart-levels-icons");0===a.html().length&&a.html('<span class="fa fa-nomargin fa-caret-up"></span><span class="fa fa-nomargin fa-caret-down"></span>');var b=a.find(".fa-caret-down"),c=a.find(".fa-caret-up");x[0].isRollPossible()?c.css("color","inherit"):c.css("color","#999999"),x[0].isDrillPossible()?b.css("color","inherit"):b.css("color","#999999")}}function s(){w.params().displayLevels&&$(z+" .chart-meta .chart-levels").html(x[0].currentLevel()+1+"/"+(x[0].maxLevel()+1))}function t(){if(w.params().displayTitle){var a,c,d=x[0].getTotal(),e=$('<span class="chart-total" data-toggle="tooltip" data-placement="bottom" title="'+d3.format(".6s  s")(d)+'">'+d3.format(".3s")(d)+" </span>").tooltip({container:"body"}),f=b.state.measure().description(),g=b.state.measure().caption(),h=x[0].description(),i=x[0].caption();a="undefined"!=typeof f&&f!=g?$('<span data-toggle="tooltip" class="chart-infos" data-placement="bottom" title="'+f+'">'+g+" </span>").tooltip({container:"body",html:!0}):g,c="undefined"!=typeof h&&h!=i?$('<span data-toggle="tooltip" class="chart-infos" data-placement="bottom" title="'+h+'">'+i+" </span>").tooltip({container:"body",html:!0}):i,$(z+" .chart-title").empty().append(a).append(" &bull; ").append(x[0].levels()[x[0].currentLevel()]).append(" &bull; ").append(c).append(" &bull; ").append(b.state.cube().caption()).append(" &bull; ").append("Total: ").append(e)}}function u(){if(w.params().displayParams){var a=$('<span class="btn-params btn btn-xs btn-default"><i class="fa fa-nomargin fa-cog"></i></span>');$(z+" .btn-params").replaceWith(a),a.click(function(){b.display._displayParamsForm(w)})}}var v,w={},x=d?d:[],y=[];w.type=function(){return"chart"},w.dimensions=function(a){return arguments.length?(x=a,w):x},w.useDimension=function(a){for(var b in x)if(x[b].equals(a))return!0;return!1},w.extraMeasures=function(a){return arguments.length?(y=a,w):y};var z=c;w._element=null,w.selector=function(){return z},w.selectorName=function(){return z.replace("#","")},w.width=function(){return $(z+" .chart-container").width()},w.height=function(){var a=$(z).height()-$(z+" .chart-header").outerHeight()-$(z+" .chart-container").outerHeight()+$(z+" .chart-container").height();return e(a),a},w.element=function(){return w._element},w.params=function(){return w._params},w.options=function(){return w._options},w.setOption=function(a,b){return"undefined"!=typeof w._options[a]&&null!==w._options[a]&&null!==b&&(w._options[a]=b),w},w.resetOptions=function(){var a=b.charts[w.type()].options;for(var c in a)w.setOption(c,a[c])},w.player=function(){return v};var A=!1;w.disabled=function(b){return arguments.length?(b&&!A?(w.element()&&a.deregisterChart(w.element()),$(z).addClass("chart-hidden")):!b&&A&&(w.element()&&a.registerChart(w.element()),$(z).removeClass("chart-hidden")),A=b,w):A};var B=!0;return w.elasticAxes=function(a){return arguments.length?(B=a,w):B},w.build=function(){return w.element()||(i(),j(),w._initContainerSpecific(),k(),A||(w._createDcElement(),l(),w._initChartSpecific())),m(),w._updateHeaderSpecific(),A||(n(),w._updateChartSpecific()),w},w.render=function(){return w.build(),A||w.element().render(),w},w.redraw=function(){return w.element()?(w.build(),A||w.element().redraw(),w):w.render()},w.resize=function(){return w.element().width(w.width()).height(w.height()),w._resizeSpecific(),$(z).css("height","auto"),w.render()},w.updateColors=function(){return"function"!=typeof w.element().colors||A||w.element().colors(x[0].scale()),w},w.delete=function(){try{a.deregisterChart(w.element())}catch(b){}$(z).empty()},w._resizeSpecific=function(){},w._createDcElement=function(){},w._initContainerSpecific=function(){},w._initChartSpecific=function(){},w._updateHeaderSpecific=function(){},w._updateChartSpecific=function(){},w.updateTitle=function(){if(!A){var a=x[0].getTotal();$(z+" .chart-total").attr("title",d3.format(".6s")(a)).html(d3.format(".3s")(a))}},w._niceDomain=function(a,b){function c(a){return"undefined"==typeof b||"undefined"==typeof a[b]?a:a[b]}var d=a.order(function(a){return-c(a)}).top(1)[0],e=a.order(function(a){return c(a)}).top(1)[0];if(void 0!==c(d.value)&&void 0!==c(e.value)){d=c(d.value),e=c(e.value);var f=Math.floor(Math.log(e)/Math.LN10+1);return d=Math.floor(d/Math.pow(10,f-2))*Math.pow(10,f-2),e=Math.ceil(e/Math.pow(10,f-2))*Math.pow(10,f-2),[d,e]}return[0,0]},w}function d(a){var d=function(c,e){var f=a(c,e);return f._params=a.params,f._options=b.utils.cloneObject(a.options),f.isPossibleDimension=d.isPossibleDimension,f.isPossibleExtraMeasure=d.isPossibleExtraMeasure,f.arePossibleDimensions=d.arePossibleDimensions,f.arePossibleExtraMeasures=d.arePossibleExtraMeasures,f.arePossibleDimensionsSpecific=d.arePossibleDimensionsSpecific,f.arePossibleExtraMeasuresSpecific=d.arePossibleExtraMeasuresSpecific,f};return d.arePossibleDimensions=function(a){for(var b in a)if(!d.isPossibleDimension(a[b]))return!1;return d.arePossibleDimensionsSpecific(a)&&a.length>=d.params.nbDimensionsMin&&a.length<=d.params.nbDimensionsMax},d.arePossibleExtraMeasures=function(a){for(var b in a)if(!d.isPossibleExtraMeasure(a[b]))return!1;return d.arePossibleDimensionsSpecific(a)&&a.length>=d.params.nbExtraMeasuresMin&&a.length<=d.params.nbExtraMeasuresMax},d.params=a.params,d.options=a.options,d.isPossibleDimension=a.isPossibleDimension||c.isPossibleDimension,d.isPossibleExtraMeasure=a.isPossibleExtraMeasure||c.isPossibleExtraMeasure,d.arePossibleDimensionsSpecific=a.arePossibleDimensionsSpecific||c.arePossibleDimensionsSpecific,d.arePossibleExtraMeasuresSpecific=a.arePossibleExtraMeasuresSpecific||c.arePossibleExtraMeasuresSpecific,d}c.params={nbDimensionsMin:1,nbDimensionsMax:1,nbExtraMeasuresMin:0,nbExtraMeasuresMax:0,displayTitle:!0,displayParams:!0,displayLevels:!0,displayCanDrillRoll:!0,displayTip:!0,displayPlay:!1},c.options={sort:null,labels:null,hideUnfiltered:!1,topK:null,topKMeasure:null,playerTimeout:1e3,height:300,heightReference:"px"},c.isPossibleDimension=function(){return!0},c.isPossibleExtraMeasure=function(){return!0},c.arePossibleDimensionsSpecific=function(){return!0},c.arePossibleExtraMeasuresSpecific=function(){return!0};var e=d(c);return e.extend=function(a){var e;if("undefined"==typeof a.params)a.params=b.utils.cloneObject(c.params);else for(e in c.params)"undefined"==typeof a.params[e]&&(a.params[e]=c.params[e]);if("undefined"==typeof a.options)a.options=b.utils.cloneObject(c.options);else for(e in c.options)"undefined"==typeof a.options[e]&&(a.options[e]=c.options[e]);var f=d(a);return f},e}(),b.charts.map=function(){var c=function(c,d){function e(a,b){var c=[];for(var d in a){var e=$.extend({},a[d][b]);e.id=d,e.properties={name:a[d].caption},c.push(e)}return c}var f=b.charts.chart(c,d);return f.type=function(){return"map"},f._initContainerSpecific=function(){},f._createDcElement=function(){f._element=a.geoChoroplethChart(f.selector()+" .chart-container")},f._initChartSpecific=function(){f.element().colorCalculator(function(a){return a?f.element().colors()(a):"#ccc"}).projection(d3.geo.mercator());var a=d3.select(f.selector()).append("div").attr("id",b.csts.css.zoom);a.append("a").attr("class","btn btn-primary fa fa-search-plus").attr("href","#").on("click",function(){return f.element().addScale(1.35,700),!1}),a.append("a").attr("class","btn btn-primary fa fa-search-minus").attr("href","#").on("click",function(){return f.element().addScale(1/1.35,700),!1})},f._updateChartSpecific=function(){var a,b=f.dimensions()[0],c=b.getLastSlice(),d=e(c,b.getGeoProperty().id()),g=f.element().geoJsons();for(a=b.currentLevel();a<g.length;a++)f.element().removeGeoJson(g[a].name);var h=function(a){return a.id};for(a=g.length;a<b.currentLevel();a++){var i=b.getSlice(a),j=e(i,b.getGeoProperty().id());f.element().overlayGeoJson(j,"geolayer-"+a,h)}f.element().overlayGeoJson(d,"geolayer-"+b.currentLevel(),h);var k=d3.format(".3s");f.element().dimension(b.crossfilterDimension()).group(b.crossfilterGroup()).setNbZoomLevels(b.maxLevel()).title(function(a){return void 0===c[a.key]?a.value?k(a.value):"":c[a.key].caption+"\nValue: "+(a.value?k(a.value):0)})},f.resizeSpecific=function(){var a=$(f.selector()).width()-30,b=$(f.selector()).height();f.element().width(a).height(b)},f};return c.options={sort:null,height:.65,hideUnfiltered:null,heightReference:"columnHeightRatio"},c.isPossibleDimension=function(a){return"Geometry"==a.type()},b.charts.chart.extend(c)}(),b.charts.pie=function(){var c=function(c,d){var e=b.charts.chart(c,d);return e.type=function(){return"pie"},e._createDcElement=function(){e._element=a.pieChart(e.selector()+" .chart-container")},e._initChartSpecific=function(){e.element().minAngleForLabel(.3).ordering(function(a){return a.value})},e._resizeSpecific=function(){e.element().radius(0)},e};return c.options={sort:"valueasc",labels:!0},b.charts.chart.extend(c)}(),b.charts.bar=function(){var c=function(c,d){var e=b.charts.chart(c,d);return e.type=function(){return"bar"},e._createDcElement=function(){e._element=a.barChart(e.selector()+" .chart-container")},e._initChartSpecific=function(){e.element().margins({top:10,right:10,bottom:110,left:40}).renderlet(function(a){a.selectAll("g.x text").attr("transform","rotate(-50) translate(-6 0)").style("text-anchor","end")}).transitionDuration(500).centerBar(!1).gap(1).elasticX(!0)},e._updateChartSpecific=function(){var b=e.dimensions()[0],c=b.getLastSlice(),d=d3.format(".3s");e.element().x(d3.scale.ordinal().domain(d3.keys(c))).xUnits(a.units.ordinal).title(function(a){var b=a.key?a.key:a.data.key;return void 0===c[b]?a.value?d(a.value):"":c[b].caption+"\nValue: "+(a.value?d(a.value):0)}),e.element().xAxis().tickFormat(function(a){return c[a].caption}),e.element().yAxis().tickFormat(function(a){return d(a)}),e.elasticAxes()?e.element().elasticY(!0):e.element().elasticY(!1).y(d3.scale.linear().domain([0,b.domain()[1]]).range([e.element().yAxisHeight(),0]))},e};return c.options={sort:"valueasc"},b.charts.chart.extend(c)}(),b.charts.timeline=function(){var a=function(a,c){function d(){var a,b,c,d=e.dimensions()[0],f=d.membersStack(),g={},h={};for(a=0;a<f.length;a++){h={};for(b in f[a])c=f[a][b].parent,h[b]=g[c]?g[c]+" - ":"",h[b]+=f[a][b].caption;g=h}return h}var e=b.charts.bar(a,c);e.type=function(){return"timeline"};var f=e._initChartSpecific;e._initChartSpecific=function(){f(),e.element().margins({top:10,right:10,bottom:100,left:40})};var g=e._updateChartSpecific;return e._updateChartSpecific=function(){g();var a=d(),b=d3.format(".3s");e.element().title(function(c){var d=c.key?c.key:c.data.key;return void 0===a[d]?c.value?b(c.value):"":a[d]+"\nValue: "+(c.value?b(c.value):0)}),e.element().xAxis().tickFormat(function(b){return a[b]})},e};return a.options={sort:null,height:.3,heightReference:"columnHeightRatio"},a.params={displayPlay:!0},a.isPossibleDimension=function(a){return"Time"==a.type()},b.charts.chart.extend(a)}(),b.charts.table=function(){var c=function(c,d){function e(a){switch(a){case"key":f.element().order(d3.ascending).sortBy(function(a){return a.key});break;case"valueasc":f.element().order(d3.descending).sortBy(function(a){return-a.value});break;default:f.element().order(d3.descending).sortBy(function(a){return a.value}),f.setOption("sort","valuedesc")}}var f=b.charts.chart(c,d);return f.type=function(){return"table"},f._initContainerSpecific=function(){$(f.selector()+" .chart-container").addClass("chart dc-chart"),$(f.selector()+" .chart-container").html("<table><thead><tr><th>Element</th><th>Value</th></tr></thead></table>")},f._createDcElement=function(){f._element=a.dataTable(f.selector()+" table")},f._initChartSpecific=function(){var a=d3.format(".3s");f.element().size(1/0).columns([function(a){var b=f.dimensions()[0].getLastSlice(),c=a.key?a.key:a.data.key;return void 0===b[c]?c:b[c].caption},function(b){return b.value?a(b.value):0}])},f._updateChartSpecific=function(){var a=f.dimensions()[0];$(f.selector()+" table th:first").html(a.caption()),$(f.selector()+" table th:last").html(b.state.measure().caption()),f.element().dimension(a.crossfilterGroup()).group(function(){return""}),e(f.options().sort)},f};return c.options={sort:"valuedesc"},b.charts.chart.extend(c)}(),b.charts.wordcloud=function(){var c=function(c,d){var e=b.charts.chart(c,d);return e.type=function(){return"wordcloud"},e._createDcElement=function(){e._element=a.wordCloudChart(e.selector()+" .chart-container")},e._initChartSpecific=function(){e.element().colorCalculator(function(a){return a?e.element().colors()(a):"#ccc"})},e};return b.charts.chart.extend(c)}(),b.charts.wordcloudWithLegend=function(){var c=function(c,d){var e=b.charts.chart(c,d);return e.type=function(){return"wordcloudWithLegend"},e._createDcElement=function(){e._element=a.wordCloudChart(e.selector()+" .chart-container")},e._initChartSpecific=function(){e.element().showLegend(e.selector()+" .wordcloud-legend").colorCalculator(function(a){return a?e.element().colors()(a):"#ccc"}),$(e.selector()+" .chart-header").css("cursor","pointer"),$(e.selector()+" .chart-header").click(function(){var a=e.dimensions()[0];b.display.aggregateDimension(a,!a.aggregated())})},e._initContainerSpecific=function(){$(e.selector()).append('<div class="wordcloud-hidden-info"></div><div class="wordcloud-legend"></div><div class="btn-dimparams-container"><span class="btn-dimparams btn btn-xs btn-default"><i class="fa fa-nomargin fa-cog"></i></span></div>'),$(e.selector()+" .btn-dimparams").click(function(){b.display._displayDimensionParamsForm(e.dimensions()[0])})},e._updateHeaderSpecific=function(){$(e.selector()+" .chart-title").prepend(e.dimensions()[0].aggregated()?'<i class="fa fa-chevron-right"></i>':'<i class="fa fa-chevron-down"></i>'),e.dimensions()[0].hideUnfiltered()?$(e.selector()+" .wordcloud-hidden-info").addClass("alert alert-warning").html('<i class="fa fa-warning"></i>'+b.csts.txts.hideUnfilteredWarning):$(e.selector()+" .wordcloud-hidden-info").removeClass("alert alert-warning").empty()},e};return c.params={displayParams:!1},c.options={hideUnfiltered:null},b.charts.chart.extend(c)}(),b.charts.bubble=function(){var c=function(c,d){var e=b.charts.chart(c,d);return e.type=function(){return"bubble"},e._createDcElement=function(){e._element=a.bubbleChart(e.selector()+" .chart-container")},e._initChartSpecific=function(){var a=d3.format(".3s");e.element().colorCalculator(function(a){var c=b.state.measure().id();return a.value[c]?e.element().colors()(a.value[c]):"#ccc"}).margins({top:0,right:0,bottom:30,left:45}).renderHorizontalGridLines(!0).renderVerticalGridLines(!0).maxBubbleRelativeSize(.075),e.element().yAxis().tickFormat(function(b){return a(b)}),e.element().xAxis().tickFormat(function(b){return a(b)})},e._updateChartSpecific=function(){var a=e.extraMeasures(),c=[a[0],a[1],b.state.measure()],d=e.dimensions()[0],f=d.getLastSlice(),g=(d.crossfilterGroup(a),d3.format(".3s"));e.element().keyAccessor(function(a){return a.value[c[0].id()]}).valueAccessor(function(a){return a.value[c[1].id()]}).radiusValueAccessor(function(a){return a.value[c[2].id()]}).x(d3.scale.linear().domain(d.domainWithPadding(.2,a,c[0]))).xAxisPadding("20%").y(d3.scale.linear().domain(d.domainWithPadding(.15,a,c[1]))).yAxisPadding("15%").r(d3.scale.linear().domain(d.domain(a,c[2]))).xAxisLabel(c[0].caption()).yAxisLabel(c[1].caption()).minRadiusWithLabel(14).title(function(a){var b=a.key?a.key:a.data.key;if(void 0===f[b])return a.value?g(a.value):"";var e=d.caption()+": "+(f[b]?f[b].caption:"")+"\n"+c[0].caption()+": "+(a.value[c[0].id()]?g(a.value[c[0].id()]):0)+"\n";return c[1].equals(c[0])||(e+=c[1].caption()+": "+(a.value[c[1].id()]?g(a.value[c[1].id()]):0)+"\n"),c[2].equals(c[0])||c[2].equals(c[1])||(e+=c[2].caption()+": "+(a.value[c[2].id()]?g(a.value[c[2].id()]):0)+"\n"),e}),e.elasticAxes()?e.element().elasticX(!0).elasticY(!0).elasticRadius(!0):e.element().elasticX(!1).elasticY(!1).elasticRadius(!1)},e};return c.options={labels:!0,height:500},c.params={nbExtraMeasuresMin:2,nbExtraMeasuresMax:2},b.charts.chart.extend(c)}(),b}"function"==typeof define&&define.amd?define(["dc"],a):"object"==typeof module&&module.exports?module.exports=a(dc):this.analytics=a(dc)}();
//# sourceMappingURL=analytics.min.js.map